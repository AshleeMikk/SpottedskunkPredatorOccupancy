---
title: "Spotted skunk predator  detection summary"
author: "Ashlee Mikkelsen"
date: "`r Sys.Date()`"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

###### Data setup
```{r}

setwd("~/Rprojects/SpottedskunkPredatorOccupancy")

library(ggplot2)
library(dplyr)
library(unmarked)
library(jagsUI)
library(wiqid)


```

Load in and format data into capture histories. Right now the file contains the number of detections (pictures) of each species during each trapping session (Ji). Each species is represented by a 4-letter code referencing the first two letters of their genus and species. For example, the first row is the number of photos of Bobcat (*Lynx rufus*) in trapping session 1: LyRu.J1

```{r}

MultiSpecies <- read.csv("MultiSpeciesCapHist_RAW.csv", header = TRUE)
str(MultiSpecies)
CapHists <- MultiSpecies[,2:17]
str(CapHists)

for (i in 1:16) {
  for (e in 1:91) {
    if(CapHists[e,i]>=1){
      CapHists[e,i]=1
    }else{
      CapHists[e,i]=0
    }
  }
}


```

###### Spotted skunks and bobcats

For my first attempt at modeling, I am going to use the co-occurance of spotted skunks and bobcats. In this scenario, spotted skunks are species B and bobcats are species A.

```{r}

DHA <- as.matrix(CapHists[,9:12])
str(DHA)

DHB <- as.matrix(CapHists[,1:4])
str(DHB)

```

The model below contains an interaction where occupancy of species B is affected by the occupancy of species A, but species A is unaffected by Species A. Thus the code for Species A looks just like a basic occupancy model.

```{r}
sink("LyRu_SpGr.txt")
cat("

model{
  # Likelihood
  for(i in 1:nSites) {
    # biological model
    zA[i] ~ dbern(psiA)
    zB[i] ~ dbern(psiB[zA[i] + 1])
    # observation model
    yA[i] ~ dbin(pA * zA[i], n)
    yB[i] ~ dbin(pB * zB[i], n)
  }

  # Priors
  pA ~ dbeta(1, 1) # Uninformative priors
  pB ~ dbeta(1, 1)
  psiA ~ dbeta(1, 1)
  psiB[1] ~ dbeta(1, 1)
  psiB[2] ~ dbeta(1, 1)
}

", fill=TRUE)

sink()


```

Below I aggregate and pack up the data into a format useable by JAGS

```{r}
# Aggregate detection data
yA <- rowSums(DHA)
yB <- rowSums(DHB)

nSites <- nrow(MultiSpecies)
zA <- ifelse(yA > 0, 1, NA)
zB <- ifelse(yB > 0, 1, NA)
nSurv <- ncol(DHA)
jagsData <- list(yA = yA, yB = yB, n = nSurv, nSites = nSites,
    zA = zA, zB = zB)
str(jagsData)

wanted <- c("pA", "pB", "psiA", "psiB")

```

Below I call Jags and run the model

```{r}

LyRu_SpGr.out <- jags(jagsData, NULL, wanted, model="LyRu_SpGr.txt",
    n.chains=4, n.adapt=2000, n.iter=20000, n.burnin = 5000,DIC=FALSE,
    parallel=TRUE)

```


And below I look at output. The model seems to have converged and the diagnostic plots look good. The last 2 plots are the estimates of spotted skunk occupancy when bobcats are absent (PsiB[1]) and when bobcats are present (Psi B[2]). While there is some overlap, it looks like bobcats have a pretty clear effect on spotted skunk occupancy.
```{r}

LyRu.SpGR_output <- mcmcOutput(LyRu_SpGr.out)
summary(LyRu.SpGR_output)

diagPlot(LyRu.SpGR_output, max=5)
postPlot(LyRu.SpGR_output)
postPlot(LyRu.SpGR_output, "psiB", xlim=c(0.25, 0.95))

```



